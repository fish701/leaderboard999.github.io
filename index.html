<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Leaderboard</title>
    <link rel="stylesheet" href="style.css">
    
    <!-- Firebase SDK -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";
        import { getFirestore, collection, getDocs, doc, setDoc, deleteDoc, onSnapshot, addDoc, updateDoc, query, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD6Mnu6hUXdv4XjIty53QjjOBenTQ0gcV0",
            authDomain: "leaderboard-f6f56.firebaseapp.com",
            projectId: "leaderboard-f6f56",
            storageBucket: "leaderboard-f6f56.firebasestorage.app",
            messagingSenderId: "490760612997",
            appId: "1:490760612997:web:e11371700e5604f8004dec",
            measurementId: "G-8X64HDBS9G"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const db = getFirestore(app);
        const auth = getAuth(app);
        
        // Configure Google Auth Provider
        const provider = new GoogleAuthProvider();
        provider.addScope('profile');
        provider.addScope('email');
        provider.setCustomParameters({
            'prompt': 'select_account'
        });
        
        // Make Firebase functions available globally
        window.firebaseApp = app;
        window.firebaseDb = db;
        window.firebaseAuth = auth;
        window.firebaseProvider = provider;
        window.firebaseSignInWithPopup = signInWithPopup;
        window.firebaseSignOut = signOut;
        window.firebaseOnAuthStateChanged = onAuthStateChanged;
        window.firebaseCollection = collection;
        window.firebaseGetDocs = getDocs;
        window.firebaseDoc = doc;
        window.firebaseSetDoc = setDoc;
        window.firebaseUpdateDoc = updateDoc;
        window.firebaseDeleteDoc = deleteDoc;
        window.firebaseOnSnapshot = onSnapshot;
        window.firebaseAddDoc = addDoc;
        window.firebaseQuery = query;
        window.firebaseWhere = where;
        
        console.log('Firebase initialized successfully');
    </script>
</head>
<body>
    <div class="container">
        <header>
            <div class="auth-section" id="authSection">
                <!-- Auth content will be populated by JavaScript -->
            </div>
            <h1>Leaderboard</h1>
            <p class="subtitle">Top performers ranked by score</p>
            
            <!-- Setup Guide -->
            <div class="setup-guide" id="setupGuide" style="display: none;">
                <h4>Google Sign-In Setup Required</h4>
                <p>To enable Google Sign-In, please follow these steps:</p>
                <ol>
                    <li>Go to <a href="https://console.firebase.google.com/" target="_blank">Firebase Console</a></li>
                    <li>Select your project "leaderboard-f6f56"</li>
                    <li>Go to Authentication ‚Üí Sign-in method</li>
                    <li>Enable "Google" provider</li>
                    <li>Add your domain to authorized domains</li>
                    <li>Save changes and refresh this page</li>
                </ol>
            </div>
        </header>
        
        <div class="controls">
            <div class="search-box">
                <span class="search-icon">üîç</span>
                <input type="text" id="searchInput" placeholder="Search players...">
            </div>
        </div>
        
        <div class="leaderboard">
            <table>
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Level</th>
                        <th>Name</th>
                        <th>Score</th>
                        <th>Progress</th>
                    </tr>
                </thead>
                <tbody id="leaderboardBody">
                    <tr>
                        <td colspan="5" class="loading">Loading leaderboard data...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <footer>
        <p>Leaderboard &copy; 2023 | Updated in real-time</p>
        <a class="change-btn" id="changeLink">Change</a>
    </footer>

    <!-- Edit Modal -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Leaderboard</h2>
                <button class="close-btn" id="closeModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="password-section">
                    <h3>Authentication Required</h3>
                    <div class="form-group">
                        <label for="passwordInput">Enter Password to Edit</label>
                        <input type="password" id="passwordInput" placeholder="Enter password">
                        <div class="error-message" id="passwordError">Incorrect password. Please try again.</div>
                    </div>
                    <button class="btn btn-primary" id="verifyPasswordBtn">Verify Password</button>
                </div>
                
                <div class="edit-section" id="editSection">
                    <div id="statusMessage"></div>
                    
                    <!-- Already Bound Section -->
                    <div class="already-bound-section" id="alreadyBoundSection" style="display: none;">
                        <h3>Account Already Bound</h3>
                        <p>Your Google account is already bound to: <strong id="boundPlayerName"></strong></p>
                        <p>Each Google account can only be bound to one player.</p>
                    </div>
                    
                    <!-- Bind Account Section -->
                    <div class="bind-section" id="bindSection" style="display: none;">
                        <h3>Bind Google Account</h3>
                        <p>You are signed in as: <strong id="currentUserEmail"></strong></p>
                        <div class="form-group">
                            <label for="playerToBind">Select Player to Bind</label>
                            <select id="playerToBind" class="form-group">
                                <option value="">Select a player...</option>
                            </select>
                        </div>
                        <button class="btn btn-success" id="bindAccountBtn">Bind Account to Player</button>
                        <hr style="margin: 20px 0;">
                    </div>
                    
                    <div class="form-group">
                        <label for="newPlayerName">Add New Player</label>
                        <input type="text" id="newPlayerName" placeholder="Enter player name">
                    </div>
                    <div class="form-group">
                        <label for="newPlayerScore">Score</label>
                        <input type="number" id="newPlayerScore" placeholder="Enter score" min="0" max="100000">
                    </div>
                    <button class="btn btn-primary" id="addPlayerBtn">Add Player</button>
                    
                    <h3 style="margin: 25px 0 15px;">Current Players</h3>
                    <div class="player-list" id="playerList">
                        <div class="loading">Loading players...</div>
                    </div>
                    
                    <div class="form-actions">
                        <button class="btn btn-secondary" id="cancelBtn">Cancel</button>
                        <button class="btn btn-success" id="saveBtn">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>

